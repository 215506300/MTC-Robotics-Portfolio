{\rtf1\ansi\ansicpg1252\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 class ModeManager:\
    def __init__(self, car, gesture_detector, safety_module=None, default_speed=30):\
        self.car = car\
        self.gesture_detector = gesture_detector\
        self.safety_module = safety_module\
        self.active_mode = "GESTURE"\
        self.default_speed = default_speed\
\
    def set_mode(self, mode):\
        if mode in ["GESTURE", "CHATGPT", "SAFETY"]:\
            self.active_mode = mode\
            print(f"Mode set to \{self.active_mode\}")\
        else:\
            print("Invalid mode")\
\
    def run_cycle(self, frame, chat_command=None):\
        if self.safety_module and self.safety_module.detect_obstacle():\
            self.car.stop()\
            print("SAFETY override: STOP")\
            return "STOP"\
\
        if self.active_mode == "GESTURE":\
            gesture, frame = self.gesture_detector.classify(frame)\
            self._execute_command(gesture)\
            return gesture\
\
        elif self.active_mode == "CHATGPT" and chat_command:\
            self._execute_command(chat_command)\
            return chat_command\
\
        else:\
            self.car.stop()\
            return "STOP"\
\
    def _execute_command(self, command):\
        if command == "FORWARD":\
            self.car.forward(self.default_speed)\
            self.car.set_dir_servo_angle(0)\
        elif command == "STOP":\
            self.car.stop()\
        elif command == "LEFT":\
            self.car.forward(self.default_speed)\
            self.car.set_dir_servo_angle(30)   # flipped sign for correct direction\
        elif command == "RIGHT":\
            self.car.forward(self.default_speed)\
            self.car.set_dir_servo_angle(-30)  # flipped sign for correct direction\
        else:\
            self.car.stop()\
}